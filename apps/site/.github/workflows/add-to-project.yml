name: Add issues & PRs to Portfolio Project

# This workflow automatically adds new issues and pull requests to the Portfolio Project
# for better project management and tracking.
#
# Purpose: Automatically manage GitHub Project items
# Triggers: New issues and pull requests
# Dependencies: Requires PORTFOLIO_PROJECT_URL and PORTFOLIO_PROJECT_TOKEN secrets
# Actions: Creates project items, validates environment, handles errors gracefully

on:
  issues:
    types: [opened, labeled]
  pull_request:
    types: [opened, ready_for_review]

# Required permissions for the workflow
# Note: Using default permissions - the action will request additional permissions as needed

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    # Only run if the required secrets are available
    if: ${{ secrets.PORTFOLIO_PROJECT_URL != '' && secrets.PORTFOLIO_PROJECT_TOKEN != '' }}
    steps:
      - name: Validate environment
        run: |
          echo "Validating required environment variables..."
          if [ -z "${{ secrets.PORTFOLIO_PROJECT_URL }}" ]; then
            echo "Error: PORTFOLIO_PROJECT_URL secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.PORTFOLIO_PROJECT_TOKEN }}" ]; then
            echo "Error: PORTFOLIO_PROJECT_TOKEN secret is not set"
            exit 1
          fi
          echo "Environment validation passed"

      - name: Add to project
        id: add-to-project
        uses: actions/add-to-project@v0.6.0
        with:
          project-url: ${{ secrets.PORTFOLIO_PROJECT_URL }}
          github-token: ${{ secrets.PORTFOLIO_PROJECT_TOKEN }}
        continue-on-error: true

      - name: Check result
        if: steps.add-to-project.outcome == 'failure'
        run: |
          echo "Warning: Failed to add item to project. This is non-critical and will not fail the workflow."
          echo "Item: ${{ github.event.issue.html_url || github.event.pull_request.html_url }}"
          echo "Project URL: ${{ secrets.PORTFOLIO_PROJECT_URL }}"
        continue-on-error: true

      - name: Success notification
        if: steps.add-to-project.outcome == 'success'
        run: |
          echo "Successfully added item to Portfolio Project"
          echo "Item: ${{ github.event.issue.html_url || github.event.pull_request.html_url }}"
