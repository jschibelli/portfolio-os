---
title: Worktree Management
description: Advanced Git worktree techniques for multi-agent development
lastUpdated: November 14, 2025
---
## Overview

Advanced Git worktree techniques for multi-agent development

Master Git worktrees for efficient multi-agent development.

## Git Worktrees Explained

Git worktrees allow multiple working directories to be attached to a single repository.

<Mermaid chart={`graph LR
    GitDB[.git Database] --> Main[Main Worktree]
    GitDB --> WT1[Worktree 1]
    GitDB --> WT2[Worktree 2]
    GitDB --> WT3[Worktree 3]
    
    Main -.->|main branch| GitDB
    WT1 -.->|feature-a| GitDB
    WT2 -.->|feature-b| GitDB
    WT3 -.->|feature-c| GitDB`} />

**Key Benefits:**
- Share Git history (no duplication)
- Independent working directories
- Separate branches
- Fast switching between features

## Creating Worktrees

### Basic Creation

```bash
# Create worktree for new branch
git worktree add -b feature/auth worktrees/agent-1 develop

# Create worktree from existing branch
git worktree add worktrees/agent-2 feature/existing

# List all worktrees
git worktree list
```

### Automated Setup

The system provides automated tooling for worktree creation that handles:
- Branch creation from the specified base
- Workspace configuration and isolation
- Dependency installation
- Environment setup

## Worktree Structure

### Recommended Organization

The multi-agent system organizes worktrees in a structured hierarchy:
- A central shared Git database serves all workspaces
- The main worktree contains the primary codebase
- Agent worktrees are grouped in a dedicated directory
- Each agent workspace is a complete, isolated working copy
- All worktrees maintain references to the shared Git database

### Naming Conventions

| Pattern | Example | Use Case |
|---------|---------|----------|
| `agent-N-name` | `agent-1-chris` | Agent-specific work |
| `feature-name` | `feature-auth` | Feature development |
| `fix-issue-N` | `fix-issue-123` | Bug fixes |
| `experiment-name` | `experiment-new-ui` | Experimental work |

## Managing Worktrees

### Common Operations

<Tabs defaultValue="create">
  <TabsList>
    <TabsTrigger value="create">Create</TabsTrigger>
    <TabsTrigger value="update">Update</TabsTrigger>
    <TabsTrigger value="remove">Remove</TabsTrigger>
  </TabsList>
  
  <TabsContent value="create">
    ```bash
    # Create new worktree
    git worktree add -b feature/new-feature worktrees/new-feature develop
    
    # Navigate to worktree
    cd worktrees/new-feature
    
    # Install dependencies
    pnpm install
    
    # Start working
    pnpm dev
    ```
  </TabsContent>
  
  <TabsContent value="update">
    ```bash
    # Navigate to worktree
    cd worktrees/agent-1
    
    # Fetch latest changes
    git fetch origin
    
    # Rebase on develop
    git rebase develop
    
    # Update dependencies
    pnpm install
    ```
  </TabsContent>
  
  <TabsContent value="remove">
    ```bash
    # First, ensure no uncommitted changes
    cd worktrees/agent-1
    git status
    
    # Commit or stash changes
    git stash
    
    # Return to main repo
    cd ../..
    
    # Remove worktree
    git worktree remove worktrees/agent-1
    
    # Or force remove
    git worktree remove --force worktrees/agent-1
    ```
  </TabsContent>
</Tabs>

### Syncing with Develop

Keep worktrees updated with develop branch:

```bash
# In worktree
git fetch origin develop
git rebase develop

# Handle conflicts if any
git rebase --continue  # after resolving

# Or abort if needed
git rebase --abort
```

## Worktree Lifecycle

<Step>
  <StepItem title="Creation">
    Create worktree for specific task:
    ```bash
    git worktree add -b feature/task worktrees/task develop
    ```
  </StepItem>

  <StepItem title="Development">
    Work in isolation:
    ```bash
    cd worktrees/task
    # Make changes
    git commit -m "feat: implement task"
    ```
  </StepItem>

  <StepItem title="Push & PR">
    Push and create PR:
    ```bash
    git push origin feature/task
    # Create PR via GitHub or script
    ```
  </StepItem>

  <StepItem title="Cleanup">
    After PR merged:
    ```bash
    cd ../..
    git worktree remove worktrees/task
    git branch -d feature/task
    ```
  </StepItem>
</Step>

## Advanced Techniques

### Dependency Management

Each worktree can manage dependencies independently to ensure isolation. While techniques exist to share dependency installations across worktrees to save disk space, independent dependency management is generally recommended to prevent version conflicts and maintain workspace isolation.

<Note type="warning">
**Warning**: Sharing dependencies between worktrees can cause issues if branches require different dependency versions.
</Note>

### Sparse Worktrees

For specialized work, Git supports sparse checkouts that only include specific directories. This technique reduces disk usage and improves performance when an agent only needs access to a subset of the codebase, such as documentation or a specific application.

### Consistent Setup

The system ensures consistent worktree initialization through:
- Standardized branch creation process
- Automated dependency installation
- Environment configuration templates
- Identity and permission setup
- Validation and verification steps


## Best Practices

<Note type="success">
**Worktree Best Practices:**

1. **One task per worktree** - Keep focused
2. **Regular cleanup** - Remove unused worktrees
3. **Meaningful names** - Easy to identify
4. **Sync frequently** - Rebase on develop daily
5. **Independent deps** - Don't share node_modules
6. **Backup work** - Push branches regularly
</Note>

## Automation & Monitoring

The system provides comprehensive worktree management capabilities:

**Automated Operations**
- Worktree creation and initialization
- Status monitoring and reporting
- Synchronization with main branch
- Cleanup and maintenance

**Health Monitoring**
- Real-time worktree status
- State validation and tracking
- Health check reporting
- Performance metrics

## Next Steps

- [Agent Coordination](/docs/multi-agent/coordination) - Coordinate multiple agents
- [Workflow Automation](/docs/multi-agent/workflow) - Automate multi-agent workflows
- [Quick Start](/docs/multi-agent/quick-start) - Get started guide
