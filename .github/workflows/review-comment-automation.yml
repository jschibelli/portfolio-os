name: Review Comment Automation

on:
  pull_request_review_comment:
    types: [created, edited]

permissions:
  pull-requests: write
  issues: write
  contents: read

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh jq

      - name: Label and optional auto-reply
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          gh auth status || gh auth login --with-token <<< "$GITHUB_TOKEN"

          PR='${{ github.event.pull_request.number }}'
          BODY='${{ github.event.comment.body }}'
          CID='${{ github.event.comment.id }}'
          LOWER=$(printf "%s" "$BODY" | tr '[:upper:]' '[:lower:]')

          # Simple triage based on keywords
          if echo "$LOWER" | grep -q "bug\|null\|undefined\|exception"; then
            gh pr edit "$PR" --add-label "type: bug" || true
          fi

          if echo "$LOWER" | grep -q "perf\|performance\|optimiz"; then
            gh pr edit "$PR" --add-label "area: performance" || true
          fi

          # Optional: dry-run auto response using your script
          # pwsh scripts/auto-response-generator.ps1 -PRNumber $PR -CommentId $CID -DryRun


